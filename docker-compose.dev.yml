# Development override configuration
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
      target: deps  # Use deps stage for dev (skips tests for fast iteration)
    image: legion-backend:dev  # Use different image tag for dev
    volumes:
      - ./backend/src:/app/src:ro  # Mount source for hot reload
    environment:
      - NODE_ENV=development
      - LOG_LEVEL=debug
    command: ["npx", "tsx", "watch", "src/index.ts"]

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: deps  # Use deps stage for dev (node image, not nginx)
    image: legion-frontend:dev  # Use different image tag for dev
    volumes:
      - ./frontend/src:/app/src:ro  # Mount source for hot reload
      - ./frontend/index.html:/app/index.html:ro
      - ./frontend/vite.config.ts:/app/vite.config.ts:ro
    ports:
      - "5173:5173"
    environment:
      - VITE_API_URL=http://localhost:3000
    command: ["npm", "run", "dev", "--", "--host", "0.0.0.0"]
